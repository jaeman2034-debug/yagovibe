name: π€ Deploy to Vercel (Legacy)

# μ΄ μ›ν¬ν”λ΅μ°λ” νΈν™μ„±μ„ μ„ν•΄ μ μ§€λ©λ‹λ‹¤.
# μƒλ΅μ΄ ci-cd.yml μ›ν¬ν”λ΅μ° μ‚¬μ©μ„ κ¶μ¥ν•©λ‹λ‹¤.

on:
  workflow_dispatch:  # μλ™ μ‹¤ν–‰λ§ κ°€λ¥
    inputs:
      environment:
        description: 'λ°°ν¬ ν™κ²½'
        required: true
        default: 'preview'
        type: choice
        options:
          - preview
          - production

jobs:
  deploy:
    runs-on: ubuntu-latest
    name: Deploy to Vercel
    
    steps:
      - name: π“¥ Checkout μ½”λ“
        uses: actions/checkout@v4

      - name: π“¦ Node.js μ„¤μ •
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: π“¦ μμ΅΄μ„± μ„¤μΉ
        run: npm ci

      - name: π” ν™κ²½ λ³€μ κ²€μ‚¬
        run: npm run check:env
        continue-on-error: true

      - name: π”§ λΉλ“ κ²€μ‚¬
        run: npm run check:build
        continue-on-error: true

      - name: π€ Vercel λ°°ν¬ (Production)
        if: github.event.inputs.environment == 'production'
        uses: amondnet/vercel-action@v25
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          vercel-args: '--prod'

      - name: π€ Vercel λ°°ν¬ (Preview)
        if: github.event.inputs.environment == 'preview'
        uses: amondnet/vercel-action@v25
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}

      - name: π“ λ°°ν¬ URL μ¶λ ¥
        if: always()
        run: |
          echo "β… λ°°ν¬ μ™„λ£!"
          echo "   ν™κ²½: ${{ github.event.inputs.environment }}"
