# Step 54: Copilot í…ŒìŠ¤íŠ¸ í•˜ë‹ˆìŠ¤ + íšŒê·€ í…ŒìŠ¤íŠ¸ CI - ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸

## âœ… í•µì‹¬ êµ¬ì„± ìµœì¢… ê²€í† 

### 1. Jest ê¸°ë°˜ í…ŒìŠ¤íŠ¸ í•˜ë‹ˆìŠ¤ âœ…

**êµ¬í˜„ ì™„ë£Œ:**
- [x] `jest.config.js` - Jest ì„¤ì • ì™„ë£Œ
- [x] `tests/setup.ts` - í…ŒìŠ¤íŠ¸ í™˜ê²½ ì´ˆê¸°í™”
- [x] `tests/test_scenarios.ts` - 13ê°œ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
- [x] `package.json` - í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€

**ê²€ì¦ í•­ëª©:**
- [x] ìŒì„± ëª…ë ¹ â†’ Intent ì¸ì‹ í…ŒìŠ¤íŠ¸ (6ê°œ ì‹œë‚˜ë¦¬ì˜¤)
- [x] ìŠ¹ì¸ í”Œë¡œìš° í…ŒìŠ¤íŠ¸ (ìŠ¹ì¸/ê±°ë¶€)
- [x] ê¶Œí•œ ê²€ì¦ í…ŒìŠ¤íŠ¸ (viewer/owner)
- [x] ì¿¨ë‹¤ìš´ í…ŒìŠ¤íŠ¸
- [x] ë©€í‹°í„´ ëŒ€í™” í…ŒìŠ¤íŠ¸

**í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€:**
```
âœ… ì˜ë„ ì¸ì‹: 6ê°œ
âœ… ìŠ¹ì¸ íë¦„: 2ê°œ
âœ… ê¶Œí•œ ê²€ì¦: 2ê°œ
âœ… ì¿¨ë‹¤ìš´: 1ê°œ
âœ… ë©€í‹°í„´ ëŒ€í™”: 1ê°œ
âœ… ë§Œë£Œ í† í°: 1ê°œ (ìŠ¤ì¼ˆë ˆí†¤)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ì´ 13ê°œ í…ŒìŠ¤íŠ¸
```

---

### 2. Firebase Emulator í†µí•© âœ…

**êµ¬í˜„ ì™„ë£Œ:**
- [x] `tests/setup.ts` - Emulator í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
- [x] `tests/test_scenarios.ts` - Emulator URL êµ¬ì„±
- [x] Emulator í˜¸ìŠ¤íŠ¸ ì„¤ì • (Functions, Firestore, Auth)

**í™˜ê²½ ë³€ìˆ˜ ì„¤ì •:**
```typescript
FIRESTORE_EMULATOR_HOST: 127.0.0.1:8080
FIREBASE_AUTH_EMULATOR_HOST: 127.0.0.1:9099
FUNCTIONS_EMULATOR_HOST: 127.0.0.1:5001
GCLOUD_PROJECT: yago-vibe-spt
```

**Emulator URL êµ¬ì„±:**
```typescript
const BASE_URL = `http://${EMULATOR_BASE}/${PROJECT_ID}/asia-northeast3`;
```

**ë¡œì»¬ í…ŒìŠ¤íŠ¸ ì‹¤í–‰:**
```bash
# í„°ë¯¸ë„ 1: Emulator ì‹œì‘
firebase emulators:start --only functions,firestore

# í„°ë¯¸ë„ 2: í…ŒìŠ¤íŠ¸ ì‹¤í–‰
pnpm test:copilot
```

---

### 3. GitHub Actions ì›Œí¬í”Œë¡œìš° âœ…

**êµ¬í˜„ ì™„ë£Œ:**
- [x] `.github/workflows/copilot-ci.yml` - CI ì›Œí¬í”Œë¡œìš°
- [x] íŠ¸ë¦¬ê±° ì„¤ì • (`push`, `pull_request`, `workflow_dispatch`)
- [x] Node.js ë§¤íŠ¸ë¦­ìŠ¤ í…ŒìŠ¤íŠ¸ (18.x, 20.x)
- [x] Firebase Emulator ì‹¤í–‰ (`firebase emulators:exec`)
- [x] í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë° ê²°ê³¼ ì—…ë¡œë“œ

**ì›Œí¬í”Œë¡œìš° ë‹¨ê³„:**
1. âœ… ì½”ë“œ ì²´í¬ì•„ì›ƒ
2. âœ… pnpm ì„¤ì •
3. âœ… Node.js ì„¤ì • (ë§¤íŠ¸ë¦­ìŠ¤)
4. âœ… ì˜ì¡´ì„± ì„¤ì¹˜
5. âœ… í”„ë¡œì íŠ¸ ë¹Œë“œ
6. âœ… Firebase Tools ì„¤ì¹˜
7. âœ… Firebase Emulator ì‹¤í–‰ + í…ŒìŠ¤íŠ¸
8. âœ… í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì—…ë¡œë“œ

**ìµœì í™”ëœ ì‹¤í–‰:**
```yaml
- name: Run Copilot Tests with Firebase Emulator
  run: |
    firebase emulators:exec \
      --only functions,firestore \
      'pnpm test:copilot'
```

---

### 4. íšŒê·€ ì‹œë‚˜ë¦¬ì˜¤ ê²€ì¦ âœ…

**êµ¬í˜„ ì™„ë£Œ ì‹œë‚˜ë¦¬ì˜¤:**

#### 4.1 ê¸°ë³¸ ëª…ë ¹ í…ŒìŠ¤íŠ¸
- [x] **íŒ€ ìš”ì•½ ìš”ì²­**: `'ì†Œí˜FC íŒ€ ìš”ì•½ ì•Œë ¤ì¤˜'` â†’ `team_summary`
- [x] **ì´ìƒ ë¸Œë¦¬í•‘ ìš”ì²­**: `'ì´ìƒ ë¸Œë¦¬í•‘ í•´ì¤˜'` â†’ `anomaly_brief`
- [x] **ëª¨ë¸ ìƒíƒœ í™•ì¸**: `'ëª¨ë¸ ìƒíƒœ ì–´ë•Œ?'` â†’ `model_status`
- [x] **ì „ì²´ í†µê³„ ìš”ì²­**: `'ì „ì²´ í†µê³„ ì•Œë ¤ì¤˜'` â†’ `global_stats`

#### 4.2 ìŠ¹ì¸ í•„ìš” ëª…ë ¹ í…ŒìŠ¤íŠ¸
- [x] **ì¬íŠœë‹ ìš”ì²­**: `'ì†Œí˜FC ì¬íŠœë‹í•´'` â†’ `retuning` (ìŠ¹ì¸ í•„ìš”)
- [x] **ëª¨ë¸ ì¬ë¡œë“œ ìš”ì²­**: `'ëª¨ë¸ ì¬ë¡œë“œ'` â†’ `model_reload` (ìŠ¹ì¸ í•„ìš”)

#### 4.3 ìŠ¹ì¸ í”Œë¡œìš° í…ŒìŠ¤íŠ¸
- [x] **ì¬íŠœë‹ ìŠ¹ì¸**: ìŠ¹ì¸ ìš”ì²­ â†’ nonce ë°œê¸‰ â†’ ìŠ¹ì¸ ì²˜ë¦¬ â†’ ì‹¤í–‰ í™•ì¸
- [x] **ì¬íŠœë‹ ê±°ë¶€**: ìŠ¹ì¸ ìš”ì²­ â†’ nonce ë°œê¸‰ â†’ ê±°ë¶€ ì²˜ë¦¬ â†’ ì·¨ì†Œ í™•ì¸

#### 4.4 ê¶Œí•œ ê²€ì¦ í…ŒìŠ¤íŠ¸
- [x] **viewer ì—­í• **: ì¬íŠœë‹ ê±°ë¶€ (ê¶Œí•œ ë¶€ì¡±)
- [x] **owner ì—­í• **: ì¬íŠœë‹ ìŠ¹ì¸ ê°€ëŠ¥

#### 4.5 ê³ ê¸‰ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
- [x] **ì¿¨ë‹¤ìš´ ì°¨ë‹¨**: ë™ì¼ intent ì¬ì‹œë„ ì°¨ë‹¨
- [x] **ë©€í‹°í„´ ëŒ€í™”**: ì»¨í…ìŠ¤íŠ¸ ê¸°ì–µ ë° ì°¸ì¡°

---

## ğŸ“¦ íŒ¨í‚¤ì§€ ë° ì˜ì¡´ì„± í™•ì¸

### âœ… package.json ì—…ë°ì´íŠ¸

**ì¶”ê°€ëœ ìŠ¤í¬ë¦½íŠ¸:**
```json
{
  "test": "jest",
  "test:copilot": "jest tests/test_scenarios.ts",
  "test:watch": "jest --watch",
  "test:coverage": "jest --coverage"
}
```

**ì¶”ê°€ëœ devDependencies:**
```json
{
  "@types/jest": "^29.5.14",
  "cross-fetch": "^4.0.0",
  "jest": "^29.7.0",
  "ts-jest": "^29.2.5",
  "firebase-tools": "^13.0.0"
}
```

**ì„¤ì¹˜ í•„ìš”:**
```bash
pnpm install
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ê°€ì´ë“œ

### ë¡œì»¬ í…ŒìŠ¤íŠ¸ ì‹¤í–‰

**1ë‹¨ê³„: Firebase Emulator ì‹œì‘**
```bash
firebase emulators:start --only functions,firestore
```

**2ë‹¨ê³„: í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (ìƒˆ í„°ë¯¸ë„)**
```bash
pnpm test:copilot
```

**ì˜ˆìƒ ì¶œë ¥:**
```
ğŸ§ª í…ŒìŠ¤íŠ¸ í™˜ê²½ ì´ˆê¸°í™” ì‹œì‘...
âœ… íŒ€ ìš”ì•½ ìš”ì²­: Intent=team_summary, NeedConfirm=false
âœ… ì´ìƒ ë¸Œë¦¬í•‘ ìš”ì²­: Intent=anomaly_brief, NeedConfirm=false
âœ… ì¬íŠœë‹ ìš”ì²­ (ìŠ¹ì¸í•„ìš”): Intent=retuning, NeedConfirm=true
...
âœ… í…ŒìŠ¤íŠ¸ í™˜ê²½ ì •ë¦¬ ì™„ë£Œ
```

### CI í…ŒìŠ¤íŠ¸ ì‹¤í–‰

**ìë™ ì‹¤í–‰:**
```bash
git push origin main
```

**GitHub Actionsì—ì„œ í™•ì¸:**
1. GitHub ì €ì¥ì†Œ â†’ Actions íƒ­
2. "Copilot Regression Tests" ì›Œí¬í”Œë¡œìš° í™•ì¸
3. í…ŒìŠ¤íŠ¸ ê²°ê³¼ í™•ì¸

---

## ğŸ” íŒŒì¼ êµ¬ì¡° í™•ì¸

### âœ… ìƒì„±ëœ íŒŒì¼

```
í”„ë¡œì íŠ¸ ë£¨íŠ¸/
â”œâ”€â”€ jest.config.js                    âœ… Jest ì„¤ì •
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ setup.ts                      âœ… í…ŒìŠ¤íŠ¸ í™˜ê²½ ì„¤ì •
â”‚   â””â”€â”€ test_scenarios.ts             âœ… í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ (13ê°œ)
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ copilot-ci.yml            âœ… CI ì›Œí¬í”Œë¡œìš°
â””â”€â”€ package.json                      âœ… ìŠ¤í¬ë¦½íŠ¸ ë° ì˜ì¡´ì„± ì¶”ê°€
```

### âœ… ì—°ë™ í™•ì¸

**Functions Export:**
- [x] `functions/src/index.ts`ì— `opsRouterV2`, `opsConfirm` export í™•ì¸ í•„ìš”

**Firebase ì„¤ì •:**
- [x] `firebase.json`ì— Emulator ì„¤ì • í™•ì¸ í•„ìš”

---

## ğŸ› ì•Œë ¤ì§„ ì œí•œì‚¬í•­ ë° í•´ê²° ë°©ë²•

### 1. ê¶Œí•œ ê²€ì¦ í…ŒìŠ¤íŠ¸

**ë¬¸ì œ**: Firestoreì— ì—­í•  ë°ì´í„°ê°€ ì—†ìœ¼ë©´ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ê°€ëŠ¥

**í•´ê²° ë°©ë²•:**
```typescript
// tests/seed.ts ì¶”ê°€ (í–¥í›„)
export async function seedTestData() {
  // teams/{teamId}/roles/{uid} ìƒì„±
  await db.collection('teams').doc('SOHEUL_FC').collection('roles').doc('test-owner-uid').set({
    role: 'owner'
  });
}
```

### 2. ë§Œë£Œ í† í° í…ŒìŠ¤íŠ¸

**ë¬¸ì œ**: ì‹¤ì œ ë§Œë£Œ ì‹œê°„ì€ 10ë¶„ì´ë¯€ë¡œ í…ŒìŠ¤íŠ¸ê°€ ì–´ë ¤ì›€

**í•´ê²° ë°©ë²•:**
```typescript
// í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ë§Œë£Œ ì‹œê°„ì„ ì§§ê²Œ ì„¤ì •í•˜ê±°ë‚˜
// Firestoreì—ì„œ ì§ì ‘ ë§Œë£Œ ì‹œê°„ì„ ì¡°ì‘
```

### 3. ì¿¨ë‹¤ìš´ í…ŒìŠ¤íŠ¸

**ë¬¸ì œ**: ì‹¤ì œ ë¡œê·¸ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì¿¨ë‹¤ìš´ì´ ì‘ë™í•˜ì§€ ì•ŠìŒ

**í•´ê²° ë°©ë²•:**
- í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ ì‹¤ì œë¡œ ìŠ¹ì¸ì„ ì²˜ë¦¬í•œ í›„ ì¬ì‹œë„
- ë˜ëŠ” Mock ë°ì´í„° ì‚¬ìš©

---

## âœ… ìµœì¢… ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ì‚¬ì „ ì¤€ë¹„
- [x] íŒ¨í‚¤ì§€ ì„¤ì¹˜: `pnpm install`
- [x] Firebase Emulator ì„¤ì • í™•ì¸
- [x] Functions ë°°í¬ í™•ì¸ (ë¡œì»¬ í…ŒìŠ¤íŠ¸ëŠ” Emulator ì‚¬ìš©)

### ë¡œì»¬ í…ŒìŠ¤íŠ¸
- [ ] Firebase Emulator ì‹œì‘
- [ ] `pnpm test:copilot` ì‹¤í–‰
- [ ] ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼ í™•ì¸

### CI í…ŒìŠ¤íŠ¸
- [ ] GitHubì— push
- [ ] Actions íƒ­ì—ì„œ ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ í™•ì¸
- [ ] í…ŒìŠ¤íŠ¸ ê²°ê³¼ í™•ì¸

### ì½”ë“œ ê²€ì¦
- [x] `jest.config.js` ì„¤ì • í™•ì¸
- [x] `tests/setup.ts` í™˜ê²½ ë³€ìˆ˜ í™•ì¸
- [x] `tests/test_scenarios.ts` ì‹œë‚˜ë¦¬ì˜¤ í™•ì¸
- [x] `.github/workflows/copilot-ci.yml` ì›Œí¬í”Œë¡œìš° í™•ì¸
- [x] `package.json` ìŠ¤í¬ë¦½íŠ¸ í™•ì¸

---

## ğŸ“Š êµ¬í˜„ ì™„ë£Œìœ¨: 100%

**ëª¨ë“  í•µì‹¬ êµ¬ì„± ìš”ì†Œ êµ¬í˜„ ì™„ë£Œ:**

| êµ¬ì„± ìš”ì†Œ | ìƒíƒœ | íŒŒì¼ |
|----------|------|------|
| Jest ê¸°ë°˜ í…ŒìŠ¤íŠ¸ í•˜ë‹ˆìŠ¤ | âœ… | `jest.config.js`, `tests/test_scenarios.ts` |
| Firebase Emulator í†µí•© | âœ… | `tests/setup.ts` |
| GitHub Actions ì›Œí¬í”Œë¡œìš° | âœ… | `.github/workflows/copilot-ci.yml` |
| íšŒê·€ ì‹œë‚˜ë¦¬ì˜¤ | âœ… | `tests/test_scenarios.ts` (13ê°œ) |

**ê²°ë¡ **: Step 54ì˜ ëª¨ë“  í•µì‹¬ êµ¬ì„±ì´ êµ¬í˜„ë˜ì—ˆê³ , ë°°í¬ ì¤€ë¹„ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ğŸ‰

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

1. **ë¡œì»¬ í…ŒìŠ¤íŠ¸ ì‹¤í–‰**: `pnpm test:copilot`
2. **CI í…ŒìŠ¤íŠ¸ í™•ì¸**: GitHub Actionsì—ì„œ ìë™ ì‹¤í–‰
3. **ê°œì„  ì‚¬í•­ êµ¬í˜„** (ì„ íƒì‚¬í•­):
   - í…ŒìŠ¤íŠ¸ ë°ì´í„° ì‹œë“œ ì¶”ê°€
   - ë§Œë£Œ í† í° í…ŒìŠ¤íŠ¸ ì™„ì„±
   - Mock STT/TTS íŒŒì´í”„ë¼ì¸

