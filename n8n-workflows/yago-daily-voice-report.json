{
    "name": "YAGO Daily Voice Report",
    "nodes": [
        {
            "parameters": {
                "cronExpression": "0 18 * * *"
            },
            "name": "Schedule Trigger",
            "type": "n8n-nodes-base.cron",
            "typeVersion": 1,
            "position": [
                250,
                300
            ]
        },
        {
            "parameters": {
                "url": "https://firestore.googleapis.com/v1/projects/YOUR_PROJECT_ID/databases/(default)/documents/voice_logs",
                "responseFormat": "json"
            },
            "name": "Get Firestore Logs",
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 1,
            "position": [
                450,
                300
            ]
        },
        {
            "parameters": {
                "functionCode": "const logs = items[0].json.documents || [];\nconst today = new Date().toISOString().split('T')[0];\nconst intents = {};\nfor (const log of logs) {\n  const intent = log.fields.intent?.stringValue || 'ë¯¸í™•ì¸';\n  intents[intent] = (intents[intent] || 0) + 1;\n}\nreturn [{ json: { date: today, intents, total: logs.length } }];"
            },
            "name": "Summarize Logs",
            "type": "n8n-nodes-base.code",
            "typeVersion": 1,
            "position": [
                650,
                300
            ]
        },
        {
            "parameters": {
                "model": "gpt-4o-mini",
                "messages": [
                    {
                        "role": "system",
                        "content": "ë„ˆëŠ” í•˜ë£¨ì¹˜ ìŒì„± ë¡œê·¸ ë¦¬í¬íŠ¸ë¥¼ ì‘ì„±í•˜ëŠ” AI ë¹„ì„œì•¼. ë°ì´í„°ë¥¼ ì½ê³  ìš”ì•½ ë³´ê³ ì„œë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ í•œêµ­ì–´ë¡œ ë§Œë“¤ì–´ì¤˜."
                    },
                    {
                        "role": "user",
                        "content": "ë°ì´í„° ìš”ì•½: {{$json}}"
                    }
                ]
            },
            "name": "Generate Summary (GPT)",
            "type": "n8n-nodes-base.openAi",
            "typeVersion": 1,
            "position": [
                850,
                300
            ]
        },
        {
            "parameters": {
                "url": "http://localhost:3001/api/generate-signature-pdf",
                "method": "POST",
                "sendBody": true,
                "bodyParameters": {
                    "parameters": [
                        {
                            "name": "intents",
                            "value": "={{$json.intents}}"
                        },
                        {
                            "name": "keywords",
                            "value": "={{$json.keywords}}"
                        },
                        {
                            "name": "summary",
                            "value": "={{$json.summary}}"
                        },
                        {
                            "name": "totalCommands",
                            "value": "={{$json.total}}"
                        }
                    ]
                },
                "responseFormat": "file"
            },
            "name": "Generate Signature PDF",
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 1,
            "position": [
                1050,
                300
            ]
        },
        {
            "parameters": {
                "resource": "message",
                "operation": "post",
                "channel": "#daily-reports",
                "text": "ğŸ“„ *YAGO VIBE ì¼ì¼ ë¦¬í¬íŠ¸* (ìë™ ì „ì†¡)\nğŸ‘‰ ì•„ë˜ PDF íŒŒì¼ì„ í™•ì¸í•˜ì„¸ìš”!",
                "attachments": [
                    {
                        "file": "={{$binary.data}}",
                        "fileName": "YAGO_Report_{{$json.date}}.pdf"
                    }
                ]
            },
            "name": "Send Slack Message",
            "type": "n8n-nodes-base.slack",
            "typeVersion": 1,
            "position": [
                1250,
                300
            ]
        }
    ],
    "connections": {
        "Schedule Trigger": {
            "main": [
                [
                    {
                        "node": "Get Firestore Logs",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Get Firestore Logs": {
            "main": [
                [
                    {
                        "node": "Summarize Logs",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Summarize Logs": {
            "main": [
                [
                    {
                        "node": "Generate Summary (GPT)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Generate Summary (GPT)": {
            "main": [
                [
                    {
                        "node": "Generate Signature PDF",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Generate Signature PDF": {
            "main": [
                [
                    {
                        "node": "Send Slack Message",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        }
    }
}
