{
  "name": "YAGO VIBE AI Daily Report with PDF",
  "nodes": [
    {
      "parameters": {
        "cronExpression": "0 18 * * *"
      },
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.cron",
      "typeVersion": 1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "url": "https://firestore.googleapis.com/v1/projects/YOUR_PROJECT_ID/databases/(default)/documents/voice_logs",
        "responseFormat": "json"
      },
      "name": "Get Firestore Logs",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [450, 300]
    },
    {
      "parameters": {
        "functionCode": "const logs = items[0].json.documents || [];\nconst today = new Date().toISOString().split('T')[0];\nconst intents = {};\nconst keywords = {};\nconst hourlyStats = {};\n\nfor (const log of logs) {\n  const intent = log.fields.intent?.stringValue || 'ë¯¸í™•ì¸';\n  const keyword = log.fields.keyword?.stringValue || '';\n  const timestamp = log.fields.ts?.timestampValue || '';\n  \n  intents[intent] = (intents[intent] || 0) + 1;\n  \n  if (keyword) {\n    keywords[keyword] = (keywords[keyword] || 0) + 1;\n  }\n  \n  if (timestamp) {\n    const hour = new Date(timestamp).getHours();\n    hourlyStats[hour] = (hourlyStats[hour] || 0) + 1;\n  }\n}\n\nconst topKeywords = Object.entries(keywords)\n  .sort(([,a], [,b]) => b - a)\n  .slice(0, 5)\n  .reduce((acc, [keyword, count]) => {\n    acc[keyword] = count;\n    return acc;\n  }, {});\n\nconst peakHour = Object.entries(hourlyStats)\n  .sort(([,a], [,b]) => b - a)[0];\n\nconst totalCommands = logs.length;\nconst successfulCommands = logs.filter(log => \n  log.fields.intent?.stringValue !== 'ë¯¸í™•ì¸'\n).length;\nconst successRate = totalCommands > 0 ? (successfulCommands / totalCommands * 100).toFixed(1) : 0;\n\nreturn [{ json: { \n  date: today, \n  intents, \n  keywords: topKeywords,\n  totalCommands,\n  successfulCommands,\n  successRate,\n  peakHour: peakHour ? `${peakHour[0]}ì‹œ (${peakHour[1]}ê±´)` : 'ë°ì´í„° ì—†ìŒ'\n} }];"
      },
      "name": "Advanced Statistics",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [650, 300]
    },
    {
      "parameters": {
        "model": "gpt-4o-mini",
        "messages": [
          {
            "role": "system",
            "content": "ë„ˆëŠ” YAGO VIBE ìŒì„± ì§€ë„ ì‹œìŠ¤í…œì˜ ì¼ì¼ ë¦¬í¬íŠ¸ë¥¼ ì‘ì„±í•˜ëŠ” AI ë¹„ì„œì•¼. ì‚¬ìš©ìì˜ ìŒì„± ëª…ë ¹ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  ì „ë¬¸ì ì´ê³  ì½ê¸° ì‰¬ìš´ í•œêµ­ì–´ ë¦¬í¬íŠ¸ë¥¼ ì‘ì„±í•´ì¤˜."
          },
          {
            "role": "user",
            "content": "ë‹¤ìŒì€ YAGO VIBE ì‹œìŠ¤í…œì˜ ì¼ì¼ ìŒì„± ëª…ë ¹ ë°ì´í„°ì…ë‹ˆë‹¤:\n\nğŸ“… ë‚ ì§œ: {{$json.date}}\nğŸ™ï¸ ì´ ëª…ë ¹: {{$json.totalCommands}}ê±´\nâœ… ì„±ê³µë¥ : {{$json.successRate}}%\n\nğŸ“ˆ Intentë³„ í†µê³„:\n{{Object.entries($json.intents).map(([intent, count]) => `- ${intent}: ${count}ê±´`).join('\\n')}}\n\nğŸ”¥ ìƒìœ„ í‚¤ì›Œë“œ Top 5:\n{{Object.entries($json.keywords).map(([keyword, count]) => `- ${keyword}: ${count}íšŒ`).join('\\n')}}\n\nâ° ê°€ì¥ í™œë°œí•œ ì‹œê°„: {{$json.peakHour}}\n\nìœ„ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ë¦¬í¬íŠ¸ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”:\n\n1. ğŸ“Š ì¼ì¼ ìš”ì•½\n2. ğŸ¯ ì£¼ìš” ì¸ì‚¬ì´íŠ¸\n3. ğŸ“ˆ ì‚¬ìš© íŒ¨í„´ ë¶„ì„\n4. ğŸ’¡ ê°œì„  ì œì•ˆ\n5. ğŸš€ ë‚´ì¼ì˜ ëª©í‘œ"
          }
        ]
      },
      "name": "Generate AI Summary",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1,
      "position": [850, 300]
    },
    {
      "parameters": {
        "url": "http://localhost:3001/api/generate-pdf",
        "method": "POST",
        "body": {
          "intents": "={{$json.intents}}",
          "keywords": "={{$json.keywords}}",
          "summary": "={{$('Generate AI Summary').item.json.choices[0].message.content}}",
          "totalCommands": "={{$json.totalCommands}}"
        },
        "responseFormat": "file"
      },
      "name": "Generate PDF",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [1050, 300]
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "post",
        "channel": "#daily-reports",
        "text": "ğŸ“„ *YAGO VIBE ì¼ì¼ ë¦¬í¬íŠ¸* (ìë™ ì „ì†¡)\n\nğŸ“Š ì˜¤ëŠ˜ì˜ ì„±ê³¼:\nâ€¢ ì´ ëª…ë ¹: {{$('Advanced Statistics').item.json.totalCommands}}ê±´\nâ€¢ ì„±ê³µë¥ : {{$('Advanced Statistics').item.json.successRate}}%\nâ€¢ ê°€ì¥ í™œë°œí•œ ì‹œê°„: {{$('Advanced Statistics').item.json.peakHour}}\n\nğŸ‘‰ ì•„ë˜ PDF íŒŒì¼ì„ í™•ì¸í•˜ì„¸ìš”!",
        "attachments": [
          {
            "file": "={{$binary.data}}",
            "fileName": "YAGO_VIBE_Report_{{$('Advanced Statistics').item.json.date}}.pdf"
          }
        ]
      },
      "name": "Send Slack Message",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 1,
      "position": [1250, 300]
    }
  ],
  "connections": {
    "Schedule Trigger": { "main": [[{ "node": "Get Firestore Logs", "type": "main", "index": 0 }]] },
    "Get Firestore Logs": { "main": [[{ "node": "Advanced Statistics", "type": "main", "index": 0 }]] },
    "Advanced Statistics": { "main": [[{ "node": "Generate AI Summary", "type": "main", "index": 0 }]] },
    "Generate AI Summary": { "main": [[{ "node": "Generate PDF", "type": "main", "index": 0 }]] },
    "Generate PDF": { "main": [[{ "node": "Send Slack Message", "type": "main", "index": 0 }]] }
  },
  "active": true,
  "settings": {},
  "versionId": "1"
}
