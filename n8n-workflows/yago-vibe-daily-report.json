// n8n ÏõåÌÅ¨ÌîåÎ°ú: YAGO VIBE ÏùºÏùº Î°úÍ∑∏ ÏöîÏïΩ ÏûêÎèôÌôî
// üìÅ ÌååÏùºÎ™Ö: yago-vibe-daily-report.json
{
    "name": "YAGO VIBE ÏùºÏùº Î¶¨Ìè¨Ìä∏",
    "nodes": [
        {
            "parameters": {
                "rule": {
                    "interval": [
                        {
                            "field": "cronExpression",
                            "value": "0 9 * * *"
                        }
                    ]
                }
            },
            "id": "cron-trigger",
            "name": "Îß§Ïùº Ïò§Ï†Ñ 9Ïãú Ïã§Ìñâ",
            "type": "n8n-nodes-base.cron",
            "typeVersion": 1,
            "position": [
                240,
                300
            ]
        },
        {
            "parameters": {
                "url": "https://firestore.googleapis.com/v1/projects/YOUR_PROJECT_ID/databases/(default)/documents/voice_logs",
                "authentication": "predefinedCredentialType",
                "nodeCredentialType": "googleApi",
                "sendQuery": true,
                "queryParameters": {
                    "parameters": [
                        {
                            "name": "pageSize",
                            "value": "1000"
                        },
                        {
                            "name": "orderBy",
                            "value": "ts desc"
                        }
                    ]
                }
            },
            "id": "firestore-api",
            "name": "Firestore Î°úÍ∑∏ Ï°∞Ìöå",
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.1,
            "position": [
                460,
                300
            ]
        },
        {
            "parameters": {
                "jsCode": "// Code Node: ÏùºÏùº Î°úÍ∑∏ ÏöîÏïΩ\nconst logs = items[0].json.documents || [];\nconst today = new Date().toISOString().split(\"T\")[0];\nconst count = logs.length;\n\nconst intents = {};\nfor (const log of logs) {\n  const intent = log.fields.intent?.stringValue || \"ÎØ∏ÌôïÏù∏\";\n  intents[intent] = (intents[intent] || 0) + 1;\n}\n\nreturn [\n  {\n    json: {\n      summary: {\n        date: today,\n        total: count,\n        intents,\n      },\n    },\n  },\n];"
            },
            "id": "data-processor",
            "name": "Îç∞Ïù¥ÌÑ∞ Ï≤òÎ¶¨",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                680,
                300
            ]
        },
        {
            "parameters": {
                "channel": "#yago-vibe-reports",
                "text": "üìä [YAGO VIBE ÏùºÏùº Î¶¨Ìè¨Ìä∏]\nüóìÔ∏è ÎÇ†Ïßú: {{ $json.summary.date }}\nüéôÔ∏è Ï¥ù ÏùåÏÑ± Î™ÖÎ†π: {{ $json.summary.total }}Í±¥\n\nüìà Intent ÌÜµÍ≥Ñ:\n{{ Object.entries($json.summary.intents).map(([intent, count]) => `- ${intent}: ${count}`).join('\\n') }}\n\nüìÑ PDF Î¶¨Ìè¨Ìä∏ Ï≤®Î∂ÄÎê® (ÏûêÎèô ÏÉùÏÑ±)",
                "otherOptions": {}
            },
            "id": "slack-notification",
            "name": "Slack ÏïåÎ¶º",
            "type": "n8n-nodes-base.slack",
            "typeVersion": 2.1,
            "position": [
                900,
                300
            ]
        }
    ],
    "connections": {
        "cron-trigger": {
            "main": [
                [
                    {
                        "node": "firestore-api",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "firestore-api": {
            "main": [
                [
                    {
                        "node": "data-processor",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "data-processor": {
            "main": [
                [
                    {
                        "node": "slack-notification",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        }
    },
    "active": true,
    "settings": {},
    "versionId": "1"
}
